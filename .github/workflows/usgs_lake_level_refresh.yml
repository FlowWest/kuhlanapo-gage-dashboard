name: USGS Lake Level Refresh

on:
  schedule:
    # 7:30am Pacific â‰ˆ 14:30 / 15:30 UTC
    - cron: "30 14 * * *"
    - cron: "30 15 * * *"
  workflow_dispatch:

jobs:
  refresh:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4
        with:
          persist-credentials: true

      - name: Set up R
        uses: r-lib/actions/setup-r@v2

      - name: Install system deps
        run: sudo apt-get install -y libcurl4-openssl-dev

      - name: Install R packages
        uses: r-lib/actions/setup-r-dependencies@v2
        with:
          packages: |
            httr
            dplyr
            lubridate
            stringr
            inldata

      - name: Fetch USGS lake level data
        run: |
          Rscript scripts/fetch_usgs_lake_level.R

      - name: Commit updated data
        run: |
          git config user.name "github-actions"
          git config user.email "github-actions@github.com"
          git add data/usgs_lake_level_11450000.rds
          git commit -m "Daily USGS lake level refresh" || echo "No changes"
          git push
